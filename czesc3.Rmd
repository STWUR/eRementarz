---
title: "Trzecie starcie - wizualizacje"
output: ioslides_presentation
---

## Ładowanie pakietów

```{r, message=FALSE, warning = FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
knitr::opts_chunk$set(fig.height = 3)
```

## Przygotowanie danych

```{r}
mieszkania <- read.csv(file = "data/mieszkania_wroclaw_ceny.csv") %>% 
  mutate(duze = metraz > 50,
         pietro = ifelse(pietro == 0, "parter",
                         ifelse(pietro == pietro_maks, "ostatnie_pietro",
                                ifelse(pietro > 15, "wysoko",
                                       ifelse(pietro_maks < 3, "niska_zabudowa", "inne")))),
         pietro = factor(pietro),
         pokoj = factor(ifelse(n_pokoj > 3, ">3", n_pokoj)))
```

## Idea ggplot

> * Podajemy jakie zmienne powinny się znaleźć na obu osiach
> * Wybieramy jakiego rodzaju wykres chcemy (punkty, słupki itp)
> * https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf

## Przypomnienie 

```{r, message=FALSE}
srednia_cena_pokoje <- mieszkania %>%
  group_by(n_pokoj) %>%
  summarise(srednia_cena = mean(cena_m2))

ggplot(srednia_cena_pokoje, aes(x = n_pokoj, y = srednia_cena)) +
  geom_bar(stat = "identity")
```

# Wykres punktowy

## Wykres punktowy

> * Każda obserwacja odpowiada jednemu punktowi na wykresie
> * Wyznaczamy jaka zmienna ma odpowiadać każdej z osi

```{r}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point()
```

##

```{r}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2, col = duze)) +
  geom_point()
```

##

> * Na poprzednim wykresie wszystko się zlewa
> * Dodajemy opcję, żeby poszczególne punkty na siebie nie nachodziły

```{r}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2, col = duze)) +
  geom_point(position = "jitter")
```

##

> * Ustawienie punktów jest tutaj losowe

```{r}
set.seed(1410)
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point(position = "jitter")
```

## Zadania

1. Narysuj wykres zależności ceny mieszkania od jego powierzchni
2. Zaznacz dodatkowo kolorem dzielnicę
3. Narysuj wykres, który pokazuje zależność między powierzchnią mieszkania a
liczbą pokojów
4. Pokaż zależność ceny $m^2$ od zmiennej *pietro*
5. (opcjonalne) Dodaj do wykresu parametr *alpha = 0.2*. Co się zmieniło?


# Facets - podziały

## 

Co jeśli chcemy zobaczyć rozkład punktów w grupach zależnych
od liczby pokojów?

```{r punty_facet_pokoj}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point(position = "jitter") +
  facet_wrap(~ pokoj)
```

##

Facets pozwalają wizualizować dane rozdzielone względem wartości określonego parametru.

## 

Argument *labeller* pozwala na automatyczne nazywanie podwykresów.

```{rfig.height=4.2}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point(position = "jitter") +
  facet_wrap(~ pokoj, labeller = label_both)
```

## 

Operator + pozwala na łącznie parametrów względem których dzielimy dane.

```{rfig.height=4.2}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point(position = "jitter") +
  facet_wrap(~ pokoj + pietro, labeller = label_both)
```

## 

facet_grid układa podwykresy w macierz, gdzie wartości dwóch parametrów definiują rzędy i kolumny.

```{rfig.height=4.2}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_point(position = "jitter") +
  facet_grid(pietro ~ pokoj, labeller = label_both)
```

## 

Facets mogą być wykorzystywane z dowolnym typem wykresów.

```{rfig.height=4.2}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2)) +
  geom_boxplot() +
  facet_wrap(~ pokoj, labeller = label_both)
```

## 


```{rfig.height=4.2}
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2, color = duze)) +
  geom_point(position = "jitter") +
  facet_grid(pietro ~ pokoj, labeller = label_both)
```

## Zadania

1. Narysuj wykres punktowy przedstawiający zależność ceny $m^2$ od liczby pokojów w podziale na dzielnice.
1. Narysuj wykres pudełkowy przedstawiający zależność ceny $m^2$ od liczby pokojów w zależności od dzielnicy i piętra. Wykorzystaj facet_grid. 


# Gęstość

## Gęstość

> * Zorientowanie się w rozkładzie
> * Odporne na małe wahania

```{r}
ggplot(mieszkania, aes(x = cena_m2)) +
  geom_density()
```

## 

```{r}
ggplot(mieszkania, aes(x = cena_m2, fill = pokoj)) +
  geom_density() 
```

## 

```{r}
ggplot(mieszkania, aes(x = cena_m2, fill = n_pokoj)) +
  geom_density(alpha = 0.2) 
```

  
# Mapy

## Kartogrm

```{r, warning=FALSE}
load("data/mapa_dzielnic.Rdata")

plot_data <- mieszkania %>%
  group_by(dzielnica) %>%
  summarise(cena_m2 = mean(cena_m2)) %>%
  inner_join(granice_dzielnic, by=c("dzielnica"="id")) 
```

## 

```{r, fig.height = 6, fig.width = 7}
ggplot(plot_data) +
  geom_polygon(aes(x=long, y=lat, group = dzielnica, fill = cena_m2))
```

##

```{r}
ggplot(plot_data) +
  geom_polygon(aes(x=long, y=lat, group = dzielnica, fill = cena_m2)) +
  coord_map()
```

## Zadania

1. Narysuj kartogram z przeciętną wielkością mieszkania w poszczególnych dzielnicach
2. Narysuj kartogram pokazujący zróżnicowanie cen (odchylenie standardowe) w poszcególnych
dzielnicach
3. Narysuj kartogram pokazujący jakie są najmnniejsze dostępne mieszkania w poszczególnych
dzielnicach

# Dodatki

## Upiększenie wykresu

> * Zamiast wymyślać koło...
> * **ggthemes**
> * scale_fill_wsj

```{r}
library(ggthemes)
```

##

```{r}
ggplot(srednia_cena_pokoje, aes(x = n_pokoj, y = srednia_cena, fill = srednia_cena)) +
  geom_bar(stat = "identity") +
  scale_fill_gradient2_tableau(palette = "Light Red-Green") +
  theme_economist_white()
```

##

```{r}
ggplot(plot_data) +
  geom_polygon(aes(x=long, y=lat, group = dzielnica, fill = cena_m2)) +
  coord_map() +
  scale_fill_gradient2_tableau() + #skala kolorów z programu tableau
  theme_fivethirtyeight()  #wygląd wykresu wzorowany na fivethirtyeight
```

## Bee swarm

```{r, warning=FALSE, message=FALSE}
library(ggbeeswarm)
ggplot(mieszkania, aes(x = dzielnica, y = cena_m2, color = duze)) +
  geom_quasirandom() +
  facet_grid(pietro ~ pokoj, labeller = label_both)
```